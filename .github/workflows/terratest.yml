name: "Terratest Test Runner"

runs:
  using: composite
  steps:
    - uses: actions/checkout@v3
      with:
        fetch-depth: 0

    - uses: actions/setup-go@v3
      with:
        go-version-file: terraform-unit-testing/go.mod
        cache: true
        cache-dependency-path: terraform-unit-testing/go.mod

    - name: Run Tests
      shell: bash
      working-directory: terraform-unit-testing
      run: |
        go install github.com/jstemmer/go-junit-report@latest
        go test -v ./... | go-junit-report -set-exit-code > report.xml

    - name: Post Test Summary
      uses: test-summary/action@v2
      with:
        paths: |
          terraform-unit-testing/report.xml
      if: always()